<header class="header">
  <div class="header-left">
    <button 
      mat-icon-button
      class="menu-toggle" 
      (click)="onMenuToggle()"
      aria-label="Toggle menu"
      type="button"
    >
      <mat-icon>menu</mat-icon>
    </button>
    
    <div class="logo" (click)="onLogoClick()">
      <mat-icon>{{ logoIcon }}</mat-icon>
      <span>{{ logoText }}</span>
    </div>
  </div>

  <div class="header-center" *ngIf="showSearch">
    <div class="search-box">
      <mat-icon class="search-icon">search</mat-icon>
      <input 
        type="text" 
        [placeholder]="searchPlaceholder"
        [(ngModel)]="searchValue"
        (input)="onSearchInput($event)"
        aria-label="Search"
        class="search-input"
      />
      <button 
        *ngIf="searchValue" 
        mat-icon-button 
        class="search-clear"
        (click)="onSearchClear()"
        aria-label="Clear search"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <div class="header-right">
    <!-- Notifications -->
    <div class="notification-container" *ngIf="showNotifications">
      <button
        mat-icon-button
        class="notifications" 
        (click)="onNotificationClick()"
        aria-label="Notifications"
        [class.active]="showNotificationDrawer"
      >
        <mat-icon 
          [matBadge]="unreadNotificationCount > 0 ? (unreadNotificationCount > 99 ? '99+' : unreadNotificationCount.toString()) : null"
          [matBadgeHidden]="unreadNotificationCount === 0"
          matBadgeColor="warn"
          matBadgeSize="small"
          matBadgePosition="above after"
        >
          notifications
        </mat-icon>
      </button>

      <!-- Notification Drawer -->
      <div class="notification-drawer" *ngIf="showNotificationDrawer">
        <div class="drawer-header">
          <h3>Notifications</h3>
          <button 
            mat-icon-button 
            (click)="onClearAllNotifications()"
            *ngIf="notifications.length > 0"
            aria-label="Clear all notifications"
          >
            <mat-icon>clear_all</mat-icon>
          </button>
        </div>
        <mat-divider></mat-divider>
        
        <div class="drawer-content">
          <div *ngIf="notifications.length === 0" class="empty-state">
            <mat-icon>notifications_none</mat-icon>
            <p>No notifications</p>
          </div>
          
          <div 
            *ngFor="let notification of notifications" 
            class="notification-item"
            [class.unread]="!notification.read"
            (click)="onNotificationItemClick(notification)"
          >
            <div class="notification-icon" [style.color]="getNotificationColor(notification.type)">
              <mat-icon>{{ getNotificationIcon(notification.type) }}</mat-icon>
            </div>
            <div class="notification-content">
              <div class="notification-title">{{ notification.title }}</div>
              <div class="notification-message">{{ notification.message }}</div>
              <div class="notification-time">{{ notification.time }}</div>
            </div>
            <div class="notification-status" *ngIf="!notification.read">
              <div class="unread-dot"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Profile -->
    <div class="profile-container" *ngIf="user">
      <div 
        class="user-profile" 
        (click)="onProfileClick()"
        role="button"
        tabindex="0"
        aria-label="User profile menu"
        [class.active]="showProfileDrawer"
      >
        <img 
          [src]="user.avatar || getDefaultAvatar()" 
          [alt]="user.name + ' avatar'"
          class="user-avatar"
        />
        <div class="user-info">
          <div class="user-name">{{ user.name }}</div>
          <div class="user-role">{{ user.role }}</div>
        </div>
        <mat-icon [class.rotated]="showProfileDrawer">expand_more</mat-icon>
      </div>

      <!-- Profile Drawer -->
      <div class="profile-drawer" *ngIf="showProfileDrawer">
        <div class="drawer-header">
          <div class="profile-info">
            <img 
              [src]="user.avatar || getDefaultAvatar()" 
              [alt]="user.name + ' avatar'"
              class="profile-avatar"
            />
            <div class="profile-details">
              <div class="profile-name">{{ user.name }}</div>
              <div class="profile-role">{{ user.role }}</div>
              <div class="profile-email" *ngIf="user.email">{{ user.email }}</div>
            </div>
          </div>
        </div>
        <mat-divider></mat-divider>
        
        <div class="drawer-content">
          <div class="profile-menu">
            <button class="menu-item" type="button">
              <mat-icon>person</mat-icon>
              <span>My Profile</span>
            </button>
            <button class="menu-item" type="button">
              <mat-icon>settings</mat-icon>
              <span>Settings</span>
            </button>
            <button class="menu-item" type="button">
              <mat-icon>help</mat-icon>
              <span>Help & Support</span>
            </button>
            <mat-divider></mat-divider>
            <button class="menu-item logout" type="button">
              <mat-icon>logout</mat-icon>
              <span>Sign Out</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- Overlay for mobile -->
<div 
  class="drawer-overlay" 
  *ngIf="showNotificationDrawer || showProfileDrawer"
  (click)="showNotificationDrawer = false; showProfileDrawer = false"
></div>